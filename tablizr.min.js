;(function($,t,e,s){"use strict";var i="tablizr",n="0.1.2",r=false,a={},l={},o={breakpoint:767,sort:true,respond:true,classSwitchOnly:false,sortHandler:null,onBeforeSort:null,onAfterSort:null,css:{pinned:{position:"absolute",left:"0",top:"0",background:"#fff",width:"35%",overflow:"hidden","overflow-x":"auto"},scrollable:{"margin-left":"35%",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-y":"hidden"},"table-wrapper":{"white-space":"nowrap",position:"relative","margin-bottom":"20px",overflow:"hidden"},"sort-trigger":{cursor:"pointer"}}};function d(t,e){this.$element=$(t);this.settings=$.extend(true,{},o,e);this.init()}d.prototype={init:function(){var t=this.$element,e=this.settings,s=t.attr("data-id");t.addClass("tablizr");if(!s){while(!s||$("#"+s).length){s=Math.floor(Math.random()*1e3)+1}t.attr("data-id",s)}if(e.sort)this.attachSort(t);if(e.respond)this.attachResponsive()},flushCssCache:function(t){if(t==s)a={};else a[t]=s},resetInlineStyles:function(t){$('[data-id="'+t+'"]').attr("style",l[t])},cssConf:function(t,e){var i=this.$element;var n=i.attr("data-id");if(a[n]==s){a[n]={};a[n]["pinned"]=$.extend({},{},this.settings.css["pinned"]);a[n]["scrollable"]=$.extend({},{},this.settings.css["scrollable"]);a[n]["table-wrapper"]=$.extend({},{},this.settings.css["table-wrapper"]);a[n]["first-child"]=$.extend({},{},this.settings.css["first-child"]);a[n]["sort-trigger"]=$.extend({},{},this.settings.css["sort-trigger"])}return e==s||!e?a[n][t]:$.extend({},a[n][e],a[n][t])},attachSort:function(t){var e=this,s=t.find("tr"),i=t.find("tbody"),n=s.first(),r=n.children("th, td");if(!n.parent().is("thead"))n.wrap("<thead />");if(!i.length){i=$("<tbody></tbody>");t.append(i)}s.each(function(t){var e=$(this);if(t!=0&&!e.parent().is("tbody"))i.append(e.detach())});r.each(function(s){var i=$(this);i.on("tap, click",function(n){e.sort(t,i,s)}).addClass("sort-trigger");if(!e.settings.classSwitchOnly){i.css(e.cssConf("sort-trigger"))}})},sort:function(t,e,s){var i,n,r,a,l=t.find("tbody"),o=l.find("tr"),d=this,c=this.settings,f=c.sortHandler,h=c.onBeforeSort,p=e.is(".sorted-asc, .sorted-desc"),u=e.is(".sorted-asc")?"desc":"asc";if(typeof h=="function")h();if(f&&typeof f=="function"){f({el:t,rows:o,col:s,isSorted:p,sortDirection:u,tablizr:this})}else{o.sort(function(t,e){var i=d.extractVal($(t),s),n=d.extractVal($(e),s),r=i.toLowerCase().localeCompare(n.toLowerCase());return!p||u=="asc"?r:r*-1});this.applySort(o,s,u)}},applySort:function(t,e,s){var i=this.$element,n=this.settings,r=n.onAfterSort,a,l,o,d,c;if(i.is(".pinned table"))i=i.closest(".table-wrapper").find(".scrollable table");l=$(i.find("tr").first().find("th, td")[e]);i.find("tr").first().find("td, th").removeClass("sorted-asc").removeClass("sorted-desc");l.addClass(s=="asc"?"sorted-asc":"sorted-desc");if(i.is(".table-wrapper table")){a=i.closest(".table-wrapper");o=a.find(".scrollable table");d=a.find(".pinned table");t.detach();o.find("tbody").html("").append(t);c=o.clone();this.attachSort(c);d.replaceWith(c);this.applyStyleFirstChild(o,c);this.setCellHeights(o,c)}else{i.find("tbody").append(t.detach())}if(typeof r=="function")r()},findHeading:function(t,e){var s=$(e.find("tr")[t])},extractVal:function(t,e){var i=$(t.find("td")[e]);var n=i.attr("data-sort");return n==s?i[0].textContent||i[0].innerText||"":n},extractCol:function(t){if(t==s)return;var e=this.$element,i=e.find("tr");stack={};i.each(function(s){if(s!=0){var i=e.find("td");stack[s]=i[t]}});return $(stack)},attachResponsive:function(){var e=this;$(t).on("redraw",function(){r=false;e.updateTables()});$(t).on("resize",function(){e.updateTables()});this.updateTables()},updateTables:function(){var t=this.$element,e=this.settings.breakpoint;if($("body").dim("w")<e&&!r){r=true;if(this.settings.sort)this.attachSort(this.splitTable(t));return true}else if(r&&$("body").dim("w")>e){r=false;this.unsplitTable(t)}},splitTable:function(t){t.wrap('<div class="table-wrapper" />');var e=t.clone(),s=this.$element.attr("data-id");this.applyStyleFirstChild(t,e);t.closest(".table-wrapper").append(e);e.wrap('<div class="pinned" />');t.wrap('<div class="scrollable" />');if(!this.settings.classSwitchOnly){e.closest(".pinned").css(this.cssConf("pinned"));t.closest(".scrollable").css(this.cssConf("scrollable"));t.closest(".table-wrapper").css(this.cssConf("table-wrapper"))}t.closest(".scrollable").gush({y:false});this.setCellHeights(t,e);return e},unsplitTable:function(t){t.closest(".table-wrapper").find(".pinned").remove();t.unwrap();t.unwrap();t.find("td:first-child, th:first-child").css("display","")},applyStyleFirstChild:function(t,e){t.find("td, th").css("display","");t.find("td:first-child, th:first-child").css("display","none");e.find("td, th").css("display","");e.find("td:not(:first-child), th:not(:first-child)").css("display","none")},setCellHeights:function(t,e){var s=t.find("tr"),i=e.find("tr"),n=[];s.each(function(t){n[t]=$(this).dim("h")});i.each(function(t){$(this).height(n[t])})}};$.fn[i]=function(t){return this.each(function(){if(!$.data(this,"plugin_"+i)){$.data(this,"plugin_"+i,new d(this,t))}})}})(jQuery,window,document);
