;(function($,t,s,e){"use strict";var i="tablizr",n="0.1.10",r=false,a={},l={},o={breakpoint:767,sort:true,respond:true,classSwitchOnly:false,sortHandler:null,onBeforeSort:null,onAfterSort:null,css:{pinned:{position:"absolute",left:"0",top:"0",background:"#fff",width:"35%",overflow:"hidden","overflow-x":"auto"},scrollable:{"margin-left":"35%",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-y":"hidden"},"table-wrapper":{"white-space":"nowrap",position:"relative","margin-bottom":"20px",overflow:"hidden"},"sort-trigger":{cursor:"pointer"}}};function d(t,s){this.$element=$(t);this.settings=$.extend(true,{},o,s);this.init()}d.prototype={init:function(){var t=this.$element,s=this.settings,e=t.attr("data-id");t.addClass("tablizr");if(!e){while(!e||$('[data-id="'+e+'"]').length){e=Math.floor(Math.random()*1e3)+1}t.attr("data-id",e)}if(s.sort)this.attachSort(t);if(s.respond)this.attachResponsive()},flushCssCache:function(t){if(t==e)a={};else a[t]=e},resetInlineStyles:function(t){$('[data-id="'+t+'"]').attr("style",l[t])},cssConf:function(t,s){var i=this.$element;var n=i.attr("data-id");if(a[n]==e){a[n]={};a[n]["pinned"]=$.extend({},{},this.settings.css["pinned"]);a[n]["scrollable"]=$.extend({},{},this.settings.css["scrollable"]);a[n]["table-wrapper"]=$.extend({},{},this.settings.css["table-wrapper"]);a[n]["first-child"]=$.extend({},{},this.settings.css["first-child"]);a[n]["sort-trigger"]=$.extend({},{},this.settings.css["sort-trigger"])}return s==e||!s?a[n][t]:$.extend({},a[n][s],a[n][t])},attachSort:function(t){var s=this,e=t.find("tr"),i=t.find("tbody"),n=e.first(),r=n.children("th, td");if(!n.parent().is("thead"))n.wrap("<thead />");if(!i.length){i=$("<tbody></tbody>");t.append(i)}e.each(function(t){var s=$(this);if(t!=0&&!s.parent().is("tbody"))i.append(s.detach())});r.each(function(e){var i=$(this);if(!i.is(".no-sort")){i.off("click.tablizr").on("click.tablizr",function(n){s.sort(t,i,e)}).addClass("sort-trigger");if(!s.settings.classSwitchOnly){i.css(s.cssConf("sort-trigger"))}}})},sort:function(t,s,e){if(typeof this.settings.onBeforeSort=="function")this.settings.onBeforeSort(this);var i,n,r,a,l=t.find("tbody"),o=l.find("tr"),d=this,c=this.settings,f=c.sortHandler,h=s.is(".sorted-asc, .sorted-desc"),p=s.is(".sorted-asc")?"desc":"asc";if(f&&typeof f=="function"){f({el:t,rows:o,col:e,isSorted:h,sortDirection:p,tablizr:this})}else{o.sort(function(t,s){var i=d.extractVal($(t),e),n=d.extractVal($(s),e),r=i.toLowerCase().localeCompare(n.toLowerCase());return!h||p=="asc"?r:r*-1});this.applySort(o,e,p)}},applySort:function(t,s,e){var i=this.$element,n=this.settings,r=n.onAfterSort,a,l,o,d,c;if(i.is(".pinned table"))i=i.closest(".table-wrapper").find(".scrollable table");l=$(i.find("tr").first().find("th, td")[s]);i.find("tr").first().find("td, th").removeClass("sorted-asc").removeClass("sorted-desc");l.addClass(e=="asc"?"sorted-asc":"sorted-desc");if(i.is(".table-wrapper table")){a=i.closest(".table-wrapper");o=a.find(".scrollable table");d=a.find(".pinned table");t.detach();o.find("tbody").html("").append(t);c=o.clone();this.attachSort(c);d.replaceWith(c);this.applyStyleFirstChild(o,c);this.setCellHeights(o,c)}else{i.find("tbody").append(t.detach())}if(typeof r=="function")r(this)},findHeading:function(t,s){var e=$(s.find("tr")[t])},extractVal:function(t,s){var i=$(t.find("td,th")[s]);var n=i.attr("data-sort");return n==e?i[0].textContent||i[0].innerText||"":n},extractCol:function(t){if(t==e)return;var s=this.$element,i=s.find("tr");stack={};i.each(function(e){if(e!=0){var i=s.find("td");stack[e]=i[t]}});return $(stack)},attachResponsive:function(){var s=this;$(t).off("redraw.tablizr").on("redraw.tablizr",function(){r=false;s.updateTables()});$(t).off("resize.tablizr").on("resize.tablizr",function(){s.updateTables()});this.updateTables()},updateTables:function(){var t=this.$element,s=this.settings.breakpoint;if($("body").dim("w")<s&&!r){r=true;if(this.settings.sort)this.attachSort(this.splitTable(t));return true}else if(r&&$("body").dim("w")>s){r=false;this.unsplitTable(t)}},splitTable:function(t){t.wrap('<div class="table-wrapper" />');var s=t.clone(),e=this.$element.attr("data-id");this.applyStyleFirstChild(t,s);t.closest(".table-wrapper").append(s);s.wrap('<div class="pinned" />');t.wrap('<div class="scrollable" />');if(!this.settings.classSwitchOnly){s.closest(".pinned").css(this.cssConf("pinned"));t.closest(".scrollable").css(this.cssConf("scrollable"));t.closest(".table-wrapper").css(this.cssConf("table-wrapper"))}t.closest(".scrollable").gush({y:false});this.setCellHeights(t,s);return s},unsplitTable:function(t){t.closest(".table-wrapper").find(".pinned").remove();t.unwrap();t.unwrap();t.find("td:first-child, th:first-child").css("display","")},applyStyleFirstChild:function(t,s){t.find("td, th").css("display","");t.find("td:first-child, th:first-child").css("display","none");s.find("td, th").css("display","");s.find("td:not(:first-child), th:not(:first-child)").css("display","none")},setCellHeights:function(t,s){var e=t.find("tr"),i=s.find("tr"),n=[];e.each(function(t){n[t]=$(this).dim("h")});i.each(function(t){$(this).height(n[t])})}};$.fn[i]=function(t){return this.each(function(){if(!$.data(this,"plugin_"+i)){$.data(this,"plugin_"+i,new d(this,t))}})}})(jQuery,window,document);
