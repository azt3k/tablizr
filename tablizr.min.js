;(function($,t,s,e){"use strict";var i="tablizr",n="0.1.0",a=false,r={},o={},l={breakpoint:767,sort:true,respond:true,classSwitchOnly:false,css:{pinned:{position:"absolute",left:"0",top:"0",background:"#fff",width:"35%",overflow:"hidden","overflow-x":"auto"},scrollable:{"margin-left":"35%",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-y":"hidden"},"table-wrapper":{"white-space":"nowrap",position:"relative","margin-bottom":"20px",overflow:"hidden"},"sort-trigger":{cursor:"pointer"}}};function d(t,s){this.$element=$(t);this.settings=$.extend(true,{},l,s);this.init()}d.prototype={init:function(){var t=this.$element,s=this.settings,e=t.attr("data-id");t.addClass("tablizr");if(!e){while(!e||$("#"+e).length){e=Math.floor(Math.random()*1e3)+1}t.attr("data-id",e)}if(s.sort)this.attachSort(t);if(s.respond)this.attachResponsive()},flushCssCache:function(t){if(t==e)r={};else r[t]=e},resetInlineStyles:function(t){$('[data-id="'+t+'"]').attr("style",o[t])},cssConf:function(t,s){var i=this.$element;var n=i.attr("data-id");if(r[n]==e){r[n]={};r[n]["pinned"]=$.extend({},{},this.settings.css["pinned"]);r[n]["scrollable"]=$.extend({},{},this.settings.css["scrollable"]);r[n]["table-wrapper"]=$.extend({},{},this.settings.css["table-wrapper"]);r[n]["first-child"]=$.extend({},{},this.settings.css["first-child"]);r[n]["sort-trigger"]=$.extend({},{},this.settings.css["sort-trigger"])}return s==e||!s?r[n][t]:$.extend({},r[n][s],r[n][t])},attachSort:function(t){var s=this,e=t.find("tr"),i=t.find("tbody"),n=e.first(),a=n.children("th, td");if(!n.parent().is("thead"))n.wrap("<thead />");if(!i.length){i=$("<tbody></tbody>");t.append(i)}e.each(function(t){var s=$(this);if(t!=0&&!s.parent().is("tbody"))i.append(s.detach())});a.each(function(e){var i=$(this);i.on("tap, click",function(n){s.sort(t,i,e)}).addClass("sort-trigger");if(!s.settings.classSwitchOnly){i.css(s.cssConf("sort-trigger"))}})},sort:function(t,s,e){var i,n,a,r=t.find("tbody"),o=r.find("tr"),l=this,d=s.is(".sorted-asc, .sorted-desc"),c=s.is(".sorted-asc")?"desc":"asc";o.sort(function(t,s){var i=l.extractVal($(t),e),n=l.extractVal($(s),e),a=i.toLowerCase().localeCompare(n.toLowerCase());return!d||c=="asc"?a:a*-1});t.find("tr").first().find("td, th").removeClass("sorted-asc").removeClass("sorted-desc");s.addClass(c=="asc"?"sorted-asc":"sorted-desc");o.detach().appendTo(r);if(t.is(".table-wrapper table")){i=t.closest(".table-wrapper");n=t.is(".pinned table")?i.find(".scrollable table"):i.find(".pinned table");if(n.is(".origin")){n.removeClass("origin")}else{t.addClass("origin");a=$(n.find("tr").first().find("th, td")[e]);this.sort(n,a,e)}}},findHeading:function(t,s){var e=$(s.find("tr")[t])},extractVal:function(t,s){var i=$(t.find("td")[s]);var n=i.attr("data-sort");return n==e?i[0].textContent||i[0].innerText||"":n},extractCol:function(t){if(t==e)return;var s=this.$element,i=s.find("tr");stack={};i.each(function(e){if(e!=0){var i=s.find("td");stack[e]=i[t]}});return $(stack)},attachResponsive:function(){var s=this;$(t).on("redraw",function(){a=false;s.updateTables()});$(t).on("resize",function(){s.updateTables()});this.updateTables()},updateTables:function(){var t=this.$element,s=this.settings.breakpoint;if($("body").dim("w")<s&&!a){a=true;if(this.settings.sort)this.attachSort(this.splitTable(t));return true}else if(a&&$("body").dim("w")>s){a=false;this.unsplitTable(t)}},splitTable:function(t){t.wrap('<div class="table-wrapper" />');var s=t.clone(),e=this.$element.attr("data-id");t.find("td:first-child, th:first-child").css("display","none");s.find("td:not(:first-child), th:not(:first-child)").css("display","none");t.closest(".table-wrapper").append(s);s.wrap('<div class="pinned" />');t.wrap('<div class="scrollable" />');if(!this.settings.classSwitchOnly){s.closest(".pinned").css(this.cssConf("pinned"));t.closest(".scrollable").css(this.cssConf("scrollable"));t.closest(".table-wrapper").css(this.cssConf("table-wrapper"))}t.closest(".scrollable").gush({y:false});this.setCellHeights(t,s);return s},unsplitTable:function(t){t.closest(".table-wrapper").find(".pinned").remove();t.unwrap();t.unwrap();t.find("td:first-child, th:first-child").css("display","")},setCellHeights:function(t,s){var e=t.find("tr"),i=s.find("tr"),n=[];e.each(function(t){n[t]=$(this).dim("h")});i.each(function(t){$(this).height(n[t])})}};$.fn[i]=function(t){return this.each(function(){if(!$.data(this,"plugin_"+i)){$.data(this,"plugin_"+i,new d(this,t))}})}})(jQuery,window,document);
